{"title":"La felicidad en relación a la renta","markdown":{"yaml":{"title":"La felicidad en relación a la renta","description":"Cómo el nivel de ingresos afectan a nuestra felicidad.\n","author":"Vera Monteagudo         (vemonse@alumni.uv.es)","date":"2023-01-08","categories":["Felicidad","PIB","Desigualdad"],"image":"./imagenes/imagen_01.png","title-block-banner":true,"title-block-banner-color":"white","toc":true,"toc-location":"left","toc-depth":3,"smooth-scroll":true,"format":{"html":{"link-external-newwindow":true}},"code-tools":true,"code-link":true},"headingText":"Introducción","containsRefs":false,"markdown":"\n\n\n\n¿Cómo somos de felices?, ¿Cómo afectan los ingresos, el PIB o la desigualdad en la percepción que tenemos de felicidad?.\nPues precisamente de esto es de lo que vamos a hablar aquí, veremos si exsiste una fórmula precisa de poder medir las causas de la felicidad de la gente... o no.\nVeremos también las correlaciones entre las felicidad y los ingresos, así como la correlación con la desigualdad, y si esto es determinante para poder sacar una conclusión sólida acerca de los niveles de felicidad.\n\n\n\n# Datos del trabajo\n\n::: {.panel-tabset}\n\n## Datos usados\n\nLos datos que hemos utilizado para este trabajo provienen de la página Kaggle. Esta pagina es\nuna comunidad online de profesionales y científicos de datos. Página recomendable para\nbuscar datos acerca de temas relacionados con R. Por si la queréis usar para hacer otros trabajos pincha [aquí](https://www.kaggle.com/).\n\nVamos a utilizar datos de un paquete dentro de Kaggle .La página web del paquete está [aquí](https://www.kaggle.com/datasets/levyedgar44/income-and-happiness-correction).\n\nEl dataset contiene observaciones sobre un conjunto de datos que reflejan la relación entre la renta y la felicidad de 111 países.\nPor tanto, vamos a analizar los datos y veremos las relaciones que guardan.\n\nBibliografía: Kaggle y web de la asignatura.\n\n## Código\n\n\n```{r}\n\n#| echo:false\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n\n```\n\n:::\n\n---\n\n# Análisis de los datos\n\n## Regiones más felices.\n\nPara comenzar con el análisis lo primero que debemos observar es el siguiente ránking, en este caso, de las regiones más felices. Las diferentes regiones están agrupadas por los datos de los países pertenecientes a dichas regiones, por tanto los 111 países de los que disponemos datos hacen la media del índice resultante por cada región. Por otro lado, las barras del gráfico están ordenadas de mayor a menor índice de felicidad en una escala de 0 a 7,5.\nTal como podemos ver, la región que lidera el índice como región más feliz es la región de Autralia y Nueva Zelanda, seguido de la de Norte América. Mientras que la región a la cola del índice es el África Subsahariana.\nPor otra parte, cabe mencionar que la región en la que se encuentra España no está mal situada en el ránking, pues es la tercera, \"Western Europe\", o como se dice en español, Europa Occidental.\n \n```{r}\n\n#| echo:false\n\n#cargamos paquetes\n\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n#importamos los datos\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n\n#Primer grafico (columnas)\n\n#hacer tabla\n\ntabla_1 <- feliz %>%\n           select (region, happy_score)%>%\n           group_by(region)%>%\n           summarise(media_felicidad_region = mean(happy_score)) %>%\n           mutate(region = as_factor(region)) %>%\n           mutate(region = fct_reorder(region,media_felicidad_region))%>%\n           ungroup()\n\np1 <- ggplot(tabla_1 , aes( media_felicidad_region , region )) + geom_col(fill = \"khaki1\") + lims(x = c(0,7.5))\n\np1 <- p1 + theme(panel.grid.major = element_line(linetype = \"blank\"),\n    panel.grid.minor = element_line(linetype = \"blank\"),\n    plot.title = element_text(family = \"AvantGarde\",\n        size = 20, face = \"italic\", colour = \"aquamarine4\"),\n    plot.subtitle = element_text(family = \"AvantGarde\",\n    size = 10, face = \"italic\", colour= \"aquamarine4\"),\n    panel.background = element_rect(fill = NA)) + labs(title = \"MEDIA DE LA FELICIDAD POR REGIONES \", subtitle = \"Media en escala 0 - 7,5\",\n    x = \"Media felicidad (0 - 7.5)\", y = NULL)\n\nggplotly(p1)\n\n```\n\n\n\n## Los datos en números\n\nEn la siguiente tabla podemos ver parte de los datos en los que se basa el estudio, de izquierda a derecha nos encontramos con los países en primer lugar, seguido del índice de felicidad (escala 0-7.5), media de los ingresos (escala 0-30.000), mediana de los ingresos y desigualdad de ingreso (escala 20-65). Además podemos ver la diferencia entre la media y la mediana para ver como de \"fiable\" es la media y que no se encuentre desvirtuada por un número reducido de grandes rentas que eleve la media.\nAnalizando un poco la tabla vemos como los países con menor índice de felicidad, son países con rentas muy bajas, pero aunque guarden una correlación positiva, cabe destacar que esto no implica causalidad, ya que por otro lado podemos observar como Costa Rica, con una media de ingresos bastante baja, es uno de los países con mayor índice de felicidad, o en el otro extremo podemos ver Luxemburgo, donde pese a poseer la media de ingresos más eleveados ni siquiera llega a un 7 en el índice de felicidad.\nAsí que, resumiendo, pese que haya fuertes correlaciones entre diferentes variables, siempre hay que tener en cuenta otros factores a la hora de analizar las causas, en este caso del índice de felicidad, y explicarlas correctamente.\n\n\n```{r}\n\n#| echo:false\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n#TABLA\n\ntabla_t <- feliz %>%\n           select(country, happy_score,avg_income,median_income,income_inequality)%>%\n           mutate(diferencia_media_mediana = avg_income-median_income, .before = income_inequality) %>%\n  mutate_if(is.numeric, funs(round(., 2)))\n\nDT::datatable(tabla_t)\n\n\n```\n\n## Correlación entre PIB y felicidad\n\nTal como veníamos hablando, existe una correlación positiva entre el nivel de ingresos y la felicidad, y la mejor forma de entenderlo es viéndolo.\nEn el siguiente gráfico podemos observar como a medida que aumenta el PIB de los países, aumenta también el índice de felicidad. Por lo que, aunque sí es cierto que hay diferentes factores que explican el ratio de felicidad y no solo nos podemos centrar en una variable explicativa, existe una tendencia clara entre el PIB y la felicidad, es decir, un PIB mayor y todo lo que eso conlleva, mejor educación; mejores sistemas sanitarios; mejores infraestructuras o mayores oportunidades laborales; etc, hace que el índice de felicidad aumente a medida que aumenta el PIB. Obviamente no será esta variable la única causa explicativa, ya que, por ejemplo, podrán haber países con PIB muy elevados pero que en cambio existan grandes desigualdades.\n\n```{r}\n\n#| echo:false\n\n#cargamos paquetes\n\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary (ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n#importamos los datos\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n#Hacemos la tabla\n\ntabla_2 <- feliz %>%\n  select (region, happy_score, gdp, country)\n\n#hacer gráfico_2.1\n\np2_1 <- ggplot(tabla_2 , aes(x = gdp, y = happy_score)) + geom_point(aes(color= region)) + geom_smooth()\n\n\np2_1 + theme(axis.title = element_text(family = \"AvantGarde\"),\n           plot.title = element_text(family = \"AvantGarde\", face = \"bold\"), panel.background = element_rect(fill = \"whitesmoke\",    linetype = \"dotted\")) + labs(title = \"ÍNDICE FELICIDAD EN RELACIÓN AL PIB\", x = \"PIB (0 - 1.6)\", y = \"Índice felicidad (2.5 - 8)\",colour = \"Regiones\") \n\n\n```\n\n\n### Ahora por regiones\n\nSiguiendo con la línea de la correlación entre PIB y felicidad, en el siguiente gráfico podemos ver lo mismo que en el de arriba pero dividido por regiones para  poder ver con mayor detalle la correlación que hay entre el PIB y el índice de felicidad en cada región. \nSeparando el gráfico por regiones podemos observar por ejemplo como en la región de Europa Occidental un aumento del PIB supone un aumento mayor al proporcional de la felicidad.\nTambíen vemos otro caso llamativo, que es la región de Asia del Sur(\"Southern Asia\"), donde precisamente en esta región existe una correlación negativa, pues a medida que aumenta el PIB disminuye la felicidad, esto nos muestra el ejemplo perfecto de que aunque hayamos visto en el otro gráfico que existía una correlación general positiva, esta no explica causalidad, ya que Asia del Sur rompe así la hipótesis de que el PIB sea el causante directo, o única varible explicativa, del aumento de la felicidad.\n\n\n\n```{r}\n\n#| echo:false\n\n\n#cargamos paquetes\n\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n#importamos los datos\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n#Segundo gráfico (facet por region)\n\n#Hacer tabla\n\n\ntabla_2 <- feliz %>%\n  select (region, happy_score, gdp, country)\n\n#hacer gráfico\n\np2 <- ggplot(tabla_2) +\n  geom_point(aes(x = gdp, y = happy_score, colour = region)) +\n  facet_wrap(vars(region))\n\n\np2 + theme(axis.title = element_text(family = \"AvantGarde\"),\n    plot.title = element_text(family = \"AvantGarde\",\n        face = \"bold\"), panel.background = element_rect(fill = \"whitesmoke\",\n        linetype = \"dotted\")) +labs(title = \"ÍNDICE FELICIDAD EN RELACIÓN AL PIB\",\n    x = \"PIB (0 - 1.6)\", y = \"Índice felicidad (2.5 - 8)\",\n    colour = \"Regiones\")\n\n\n\n```\n\n\n## Desigualdad y felicidad por países \n\nComo veníamos diciendo el PIB no puede determinar de forma aislada el índice de felicidad, puesto que hay otros causantes, como la desigualdad, que también pueden explicar los distintos niveles de felicidad.\nEn el siguiente mapa se pueden ver los índices de desigualdad por países agrupados en cuatro niveles según el grado de desigualdad en una escala de 1 a 4, donde los países pertenecientes al primer grupo son los países con menor desigualdad de ingresos, siendo el cuarto grupo el que nos indica los países con mayores desigualdades.\nSi comparamos con el mapa de la felicidad, el cual también está agrupado por niveles de felicidad en una escala del 1 al 4, donde los países del nivel uno tienen los índices de felicidad más bajos y los países de nivel cuatro los que mayor índice tienen, podemos observar, por ejemplo, correlaciones positivas entre los países nórdicos donde índices muy bajos de desigualdad implican niveles muy altos de felicidad.\nEn cambio toda la región de América tiene unos índices elevados de forma generalizada y en cambio también tiene unos índices altos de desigualdad, por lo que deja de haber una correlación positiva.\n\n```{r}\n\n#| echo:false\n\n\nlibrary(rio)\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggthemes)\nlibrary(ggThemeAssist)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(plotly)\nlibrary(gganimate)\nlibrary(ggThemeAssist)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(gapminder)\nlibrary(viridis)\nlibrary(highcharter)\nlibrary(treemapify)\nlibrary(treemap)\n\n\n#fs::dir_create(\"datos\")\n\n#importamos los datos de la carpeta datos\n\nhappy <- rio::import(\"./datos/happyscore_income.csv\")\n\n#limpiar nombres\n\nfeliz <- janitor::clean_names(happy)\n\n\n#MAPA 2\n\n#Hacer tabla\n\ntabla_m <- feliz %>%\n  select(country,income_inequality)\n\n#mapa\n\nworld <- rnaturalearth::ne_countries(scale = \"medium\", returnclass = \"sf\")\n\nworld <- world %>% filter(subregion != \"Antarctica\") %>% filter(admin != \"Greenland\")\n\nworld <- world %>% select(name, iso_a3, geometry)\n\ndf_world <- left_join(world, tabla_m, by = c(\"name\" = \"country\") ) %>%\n  #filter(!is.na(iso_a3)) %>%\n  mutate(income_inequality_4 = as_factor(ntile(income_inequality, 4)))\n\np3 <- ggplot(df_world) + geom_sf(aes(geometry = geometry, fill = income_inequality_4)) \n\n\np3 + theme(plot.title = element_text(family = \"mono\",\n                                     hjust = 0.5), panel.background = element_rect(fill = NA)) +labs(title = \"ÍNDICE DE DESIGUALDAD POR PAÍSES\", fill = \"Desigualdad \") \n\n#mapa felicidad\n\ntabla_3 <- feliz %>%\n           select(country,happy_score)\n\n#mapa\n\nworld <- rnaturalearth::ne_countries(scale = \"medium\", returnclass = \"sf\")\n\nworld <- world %>% filter(subregion != \"Antarctica\") %>% filter(admin != \"Greenland\")\n\nworld <- world %>% select(name, iso_a3, geometry)\n\ndf_world <- left_join(world, tabla_3, by = c(\"name\" = \"country\") ) %>%\n            #filter(!is.na(iso_a3)) %>%\n            mutate(happy_score_4 = as_factor(ntile(happy_score, 4)))\n\np3 <- ggplot(df_world) + geom_sf(aes(geometry = geometry, fill = happy_score_4)) \n\n\np3 + theme(plot.title = element_text(family = \"mono\",\n    hjust = 0.5), panel.background = element_rect(fill = NA)) +labs(title = \" ÍNDICE DE FELICIDAD POR PAÍSES\",\n    fill = \"Felicidad \") + scale_fill_viridis_d() \n\n\n\n\n\n```\n\n# Conclusiones\n\nDespués de haber visto las relaciones que tienen el PIB y la desigualdad con la felicidad, y dejar claro que las correlaciones no implican causalidad y haberlo ejemplificdo con los distintos casos, solo cabe decir que la felicidad como variable dependiente es diferente en cada país, y estará constituida a su vez por diferentes variables explicativas con parámetros disintos, por lo que dependiendo de cada país, el PIB; la desigualdad; las costumbres o incluso el clima; entre otros, afectarán y explicarán de manera distinta los índices de felicidad.\nY aunque las correlaciones nos puedan mostrar que pueden haber modelos parecidos entre países, las tendencias no serán nunca decisivas en la explicación de los disferentes modelos.\n\n---\n\nPara felicidad la de este niño, peace and love!!\n\n<center><img src=\"imagenes/niño.png\" width = \"500px\" /></center>\n\n<br>\n\n---\n\n<br>\n\n### Información sobre la sesión\n\nAbajo muestro mi entorno de trabajo y paquetes utilizados\n\n```{r}\n#| echo: false\nsessioninfo::session_info() %>% \n  details::details(summary = 'current session info') \n```\n\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"wrap","code-link":true,"code-line-numbers":true,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"a11y","css":["my_styles.css"],"toc":true,"toc-depth":3,"output-file":"my_trabajo_BigData.html"},"language":{},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.2.269","knitr":{"opts_chunk":{"collapse":true,"comment":"#>","fig.asp":"7/9","out.width":"95%","fig.align":"center","fig.show":"hold","R.options":"options(scipen = 999)"}},"theme":"flatly","page-layout":"full","code-copy":true,"title":"La felicidad en relación a la renta","description":"Cómo el nivel de ingresos afectan a nuestra felicidad.\n","author":"Vera Monteagudo         (vemonse@alumni.uv.es)","date":"2023-01-08","categories":["Felicidad","PIB","Desigualdad"],"image":"./imagenes/imagen_01.png","title-block-banner":true,"title-block-banner-color":"white","toc-location":"left","smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}}}